<template name="modal-explain"><view class="modal {{ hide?'hide':'' }}" bindtap="hideExplain"><view class="modal-container" data-id="explain"><view class="modal-title one-px-border-bottom" data-id="explain">改签说明</view><view class="modal-body" data-id="explain"><view wx:for="{{content}}" class="content" wx:for-item="list" data-id="explain"><image src="/images/migrate-explain-{{index}}.png" class="icon" data-id="explain"></image><view class="text" data-id="explain"><view wx:for="{{list}}" wx:for-item="text" data-id="explain"><view data-id="explain">{{text}}</view></view></view></view><view class="tips" data-id="explain">对于作弊行为，我们有权取消您后续的改签权利，必要时将追究法律责任</view><button size="default" bindtap="applyMigrate" data-id="explain">开始改签</button></view></view></view></template><view wx:if="{{ order }}" class="{{ migrateExplain.hide?'':'dontmove' }}"><view class="panel show-panel first-panel"><view class="show"><view class="show-content"><view class="movie-name-container"><view class="movie-name"><text>{{ order.movieName }}</text></view><view wx:if="{{ !!migrate[migrate.role] && migrate.role=='target'}}" class="migrate-label"><text>改签票</text></view></view><text class="show-time">{{ order.orderShowTime }}</text><text class="show-info">（{{ language }}{{ show.dim }}）</text><text>{{ order.cinemaName }}</text><view class="seats"><text>{{order.orderSeats}}</text></view><view wx:if="{{endEgg.desc}}" class="egg"><image class="img img-icon" src="/images/egg.png"></image><text>{{ endEgg.desc }}</text></view></view></view><view class="order-info {{ order.status != 100 ? '' : 'filter-gray' }}"><image mode="aspectFit" class="stamp" wx:if="{{ order.status == 100  }}" src="{{ orderStatusMap['' + order.uniqueStatus + refund.refundProgress] || '/images/order/ticket-finish.png' }}"/><view wx:if="{{ order.uniqueStatus != 7 }}"><view wx:if="{{ exchange.originId }}"><text class="key">{{ exchange.originIdName }}</text><text class="value">{{ exchange.originIdChunk || exchange.originId }}</text></view><view wx:if="{{ exchange.exchangeCode }}"><text class="key">{{ order.externalOrderCode }}</text><text class="value">{{ exchange.exchangeCodeChunk || exchange.exchangeCode }}</text></view><view class="qrcode"><image mode="aspectFit" src="https://wx.maoyan.com/qr?text={{ order.externalOrderCode }}"/></view></view></view><view wx:if="{{ !!migrate[migrate.role] && migrate[migrate.role].status!==2 && migrate.role=='target'}}" class="order-result"><view class="ticket-state"><view wx:if="{{migrate[migrate.role].status==1}}"><image src="/images/order/ticket-wait-box.png" mode="aspectFit" class="ticket-state-icon"/><view class="ticket-wait-ticket"><image src="/images/order/ticket-wait-ticket.png"/></view></view><view wx:else><image src="/images/order/ticket-fail.png" mode="aspectFit" class="ticket-state-icon"/></view></view><view class="order-result-title">{{ migrate[migrate.role].statusDesc }}</view><view class="order-result-help">{{ migrate[migrate.role].statusSubDesc }}</view></view><view wx:elif="{{ order.uniqueStatus == 6 || order.uniqueStatus == 7 }}" class="order-result"><view class="ticket-state"><image src="{{abnormalStatusMap[order.uniqueStatus].icon }}" mode="aspectFit" class="ticket-state-icon"/><view wx:if="{{ order.uniqueStatus == 6 }}" class="ticket-wait-ticket"><image src="/images/order/ticket-wait-ticket.png"/></view></view><view class="order-result-title">{{ abnormalStatusMap[order.uniqueStatus].title }}</view><view class="order-result-help">{{ order.statusDesc }}</view></view></view><view wx:if="{{ source != 'orderlist' && order.uniqueStatus == 7 }}" class="btn-container"><button bindtap="back">重新购票</button></view><view class="order panel"><view class="flex"><view class="flex-item orderInfo"><text>订单号: {{ id }}</text><text>总价: {{ order.totalPrice / 100 }}元</text></view><view class="button-box"><view wx:if="{{migrate.display}}"><view wx:if="{{!!migrate.allow}}"><view class="button button-migrate" bindtap="showExplain">{{migrateProgressMap[0]}}</view></view><view wx:elif="{{!!migrate[migrate.role]}}"><view class="button button-disabled">{{migrateProgressMap[migrate[migrate.role].status]}}</view></view><view wx:else><view class="button button-disabled" bindtap="showExplain">{{migrateProgressMap[0]}}</view></view></view><view wx:if="{{refund.shouldDisplayRefund || refund.refundProgress }}"><view wx:if="{{ cinema.allowRefund }}"><view class="button {{ !!refund.allow?'':'button-disabled' }}" bindtap="applyRefund">{{refundProgressMap[refund.refundProgress]}}</view></view><view wx:else><view class="button button-noborder">{{refund.notAllowRefundReason}}</view></view></view></view></view><view wx:if="{{!!refund.desc || !!migrate.desc}}" class="tips-container one-px-border-top"><view wx:if="{{!!refund.desc}}" class="flex {{!!refund.allow? 'tip': 'tip-disabled'}}"><image src="/images/order/{{theme}}support-{{!!refund.allow}}.png" class="tip-icon"></image>{{ refund.desc }}</view><view wx:if="{{!!migrate.desc}}" class="flex {{!!migrate.allow? 'tip': 'tip-disabled'}}"><image src="/images/order/{{theme}}support-{{!!migrate.allow}}.png" class="tip-icon"></image>{{ migrate.desc }}</view></view></view><view class="panel cinema-panel two-columns"><view><text class="cinema-name">{{ order.cinemaName }}</text><text class="cinema-address gray-light">{{ order.cinemaAddress }}</text></view><view class="map" bindtap="onTapMap"><image src="/images/map.png" mode="aspectFit"></image></view></view></view><template is="modal-explain" data="{{...migrateExplain}}"></template><modal confirm-text="{{!refund.shouldDisplayRefund && !refund.refundProgress? '知道了': '查看退款进度'}}" no-cancel="{{!refund.shouldDisplayRefund && !refund.refundProgress}}" cancel-text="关闭" hidden="{{!migrateModalShow}}" bindconfirm="{{!refund.shouldDisplayRefund && !refund.refundProgress?'migrateModalCancel':'migrateModalConfirm'}}" bindcancel="migrateModalCancel"><view class="order-result-small"><image src="/images/order/checked.png" class="ticket-state"/><view class="order-result-small-title">{{ migrate[migrate.role].statusDesc }}</view><view class="order-result-small-help">{{ migrate[migrate.role].statusSubDesc }}</view></view></modal><view class="share-tips" wx:if="{{showSuccessPopup}}" bindtap="closePopup"><view class="banner" catchtap="doNothing"><view wx:if="{{popupData.img}}" style="background:url({{popupData.img}}) no-repeat;background-size: 690rpx 390rpx" class="banner-img"></view><view class="show-text-btn" wx:if="{{popupData.confirmBtnUrl}}">{{popupData.confirmBtnText}}</view><view wx:if="{{popupData.desc}}"><text>{{popupData.desc}}</text></view><view class="tips-text"><text>{{popupData.subDesc}}</text></view><image src="/images/close-white.png" bindtap="closePopup" class="close"></image></view></view><view wx:if="{{ !hasAuth }}" class="error-page middle-center-page"><image src="/images/lost.png"/><text class="content">您暂无权限查看该页面</text></view><include src="/footer.wxml" />
